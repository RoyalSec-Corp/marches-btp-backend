// ============================================
// MarchesBTP - Model ContractSignature
// ============================================

model ContractSignature {
  id            Int         @id @default(autoincrement())
  contratId     Int         @map("contrat_id")

  // Signataire - IDs séparés pour éviter les conflits FK
  freelanceId   Int?        @map("freelance_id")
  entrepriseId  Int?        @map("entreprise_id")
  signerType    SignerType  @map("signer_type")
  signerName    String      @map("signer_name")

  // Signature
  signatureData String?     @map("signature_data") @db.Text
  ipAddress     String?     @map("ip_address")

  // Timestamps
  signedAt      DateTime    @default(now()) @map("signed_at")

  // Relations
  contrat       Contrat     @relation(fields: [contratId], references: [id], onDelete: Cascade)
  freelance     Freelance?  @relation(fields: [freelanceId], references: [id], onDelete: Cascade)
  entreprise    Entreprise? @relation(fields: [entrepriseId], references: [id], onDelete: Cascade)

  @@map("contract_signatures")
  @@unique([contratId, signerType])
  @@index([contratId])
  @@index([freelanceId])
  @@index([entrepriseId])
}
