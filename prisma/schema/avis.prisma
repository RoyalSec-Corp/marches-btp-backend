// ============================================
// MarchesBTP - Model Avis
// MVP2 : Notation des freelances
// ============================================

model Avis {
  id              Int         @id @default(autoincrement())
  
  // Contrat associe
  contratId       Int         @map("contrat_id")
  
  // Auteur (entreprise qui note)
  auteurId        Int         @map("auteur_id")
  auteurType      String      @map("auteur_type")
  
  // Cible (freelance note)
  cibleId         Int         @map("cible_id")
  cibleType       String      @map("cible_type")
  
  // Notes (sur 5)
  noteGlobale     Float       @map("note_globale")
  noteQualite     Float?      @map("note_qualite")
  noteDelais      Float?      @map("note_delais")
  noteCommunication Float?    @map("note_communication")
  notePrix        Float?      @map("note_prix")
  
  // Commentaire
  titre           String?
  commentaire     String?     @db.Text
  
  // Reponse du freelance
  reponse         String?     @db.Text
  reponseAt       DateTime?   @map("reponse_at")
  
  // Moderation
  isPublic        Boolean     @default(true) @map("is_public")
  isVerified      Boolean     @default(false) @map("is_verified")
  moderationStatus AvisStatus @default(EN_ATTENTE) @map("moderation_status")
  moderatedBy     Int?        @map("moderated_by")
  moderatedAt     DateTime?   @map("moderated_at")
  moderationNote  String?     @map("moderation_note")
  
  // Timestamps
  createdAt       DateTime    @default(now()) @map("created_at")
  updatedAt       DateTime    @updatedAt @map("updated_at")

  // Relations
  contrat         Contrat     @relation(fields: [contratId], references: [id], onDelete: Cascade)

  @@map("avis")
  @@unique([contratId, auteurId])
  @@index([contratId])
  @@index([auteurId])
  @@index([cibleId])
  @@index([noteGlobale])
  @@index([moderationStatus])
  @@index([isPublic])
}
