// ============================================
// MarchesBTP - Models Jalons Contrat
// MVP2 : Paiements par etapes
// ============================================

model ContractMilestone {
  id              Int               @id @default(autoincrement())
  contratId       Int               @map("contrat_id")
  
  // Details
  titre           String
  description     String?           @db.Text
  ordre           Int               @default(1)
  
  // Montant
  montant         Float
  pourcentage     Float?            @map("pourcentage")
  
  // Dates
  dateEcheance    DateTime?         @map("date_echeance")
  dateDebut       DateTime?         @map("date_debut")
  dateFin         DateTime?         @map("date_fin")
  
  // Statut
  statut          MilestoneStatus   @default(EN_ATTENTE)
  
  // Validation
  validePar       Int?              @map("valide_par")
  valideAt        DateTime?         @map("valide_at")
  commentaire     String?           @db.Text
  
  // Timestamps
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")

  // Relations
  contrat         Contrat           @relation(fields: [contratId], references: [id], onDelete: Cascade)
  paiements       Paiement[]

  @@map("contract_milestones")
  @@unique([contratId, ordre])
  @@index([contratId])
  @@index([statut])
  @@index([dateEcheance])
}
