// ============================================
// MarchesBTP - Model AppelOffre
// ============================================

model AppelOffre {
  id                Int                     @id @default(autoincrement())

  // Contenu
  titre             String
  description       String?                 @db.Text
  budget            String?
  ville             String?
  typeConstruction  String?                 @map("type_construction")
  secteur           String?

  // Type d'emetteur
  typePersonne      TypePersonne            @default(PROFESSIONNEL) @map("type_personne")

  // Proprietaire — publisherId trace toujours le créateur (userId)
  publisherId       Int?                    @map("publisher_id")
  entrepriseId      Int?                    @map("entreprise_id")
  adminId           Int?                    @map("admin_id")

  // Scraping (prepare pour MVP2)
  urlSource         String?                 @map("url_source") @db.Text

  // Cible
  cible             String?                 @default("TOUS")

  // Statut
  statutCompte      AppelOffreStatus        @default(BROUILLON) @map("statut_compte")

  // Dates
  dateLimite        DateTime?               @map("date_limite")
  dateCreation      DateTime                @default(now()) @map("date_creation")

  // Relations
  publisher         User?                   @relation("PublishedAppelOffres", fields: [publisherId], references: [id], onDelete: SetNull)
  entreprise        Entreprise?             @relation(fields: [entrepriseId], references: [id], onDelete: SetNull)
  candidatures      AppelOffreCandidature[]
  contrats          Contrat[]
  messages          Message[]

  @@map("appels_offres")
  @@index([publisherId])
  @@index([entrepriseId])
  @@index([statutCompte])
  @@index([ville])
  @@index([secteur])
  @@index([dateLimite])
}
