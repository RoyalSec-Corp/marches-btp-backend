// ============================================
// MarchesBTP - Models Paiement
// MVP2 : Integration Societe Generale
// ============================================

model Paiement {
  id                  Int             @id @default(autoincrement())
  
  // Reference
  reference           String          @unique
  
  // Contrat lie
  contratId           Int             @map("contrat_id")
  milestoneId         Int?            @map("milestone_id")
  
  // Montants
  montant             Float
  montantHT           Float?          @map("montant_ht")
  montantTVA          Float?          @map("montant_tva")
  devise              String          @default("EUR")
  
  // Parties
  payeurId            Int             @map("payeur_id")
  payeurType          String          @map("payeur_type")
  beneficiaireId      Int             @map("beneficiaire_id")
  beneficiaireType    String          @map("beneficiaire_type")
  
  // Methode
  methodePaiement     PaymentMethod   @map("methode_paiement")
  
  // Statut
  statut              PaymentStatus   @default(EN_ATTENTE)
  
  // Societe Generale
  sgTransactionId     String?         @map("sg_transaction_id")
  sgStatus            String?         @map("sg_status")
  sgResponseData      String?         @map("sg_response_data") @db.Text
  
  // Dates
  dateCreation        DateTime        @default(now()) @map("date_creation")
  datePaiement        DateTime?       @map("date_paiement")
  dateEcheance        DateTime?       @map("date_echeance")
  
  // Facture
  factureUrl          String?         @map("facture_url")
  factureNumber       String?         @map("facture_number")

  // Relations
  contrat             Contrat         @relation(fields: [contratId], references: [id], onDelete: Restrict)
  milestone           ContractMilestone? @relation(fields: [milestoneId], references: [id], onDelete: SetNull)

  @@map("paiements")
  @@index([contratId])
  @@index([milestoneId])
  @@index([payeurId])
  @@index([beneficiaireId])
  @@index([statut])
  @@index([reference])
  @@index([dateCreation])
}
